import{A}from"./add-7f1df6ed.js";import{d as w,c as p,o as u,a as m,b as t,F as C,r as E,t as B,u as e,e as I,f as x,g as P,h as N,i as Y,_ as F,w as v,v as y,j as f,p as L,k as j,l as T,m as D,n as $,q as U,T as q,s as S,x as M,B as O}from"./index-85516e1b.js";import{E as H,g as z,a as G}from"./navigation-helpers-1ee623e9.js";import{u as R,a as J}from"./book-store-70aea76a.js";import{u as K,_ as Q,T as W}from"./use-page-7649b31a.js";import"./lodash-c76a3c9d.js";const X=["data-testid"],Z={class:"authors"},tt=["textContent"],et=["src","alt","title"],ot={"data-testid":"book-title",class:"text-start"},st={class:"text-end"},lt={class:"d-flex gap-2"},nt=["data-testid"],at=["data-testid"],dt=w({__name:"BookTableRow",props:{book:null},setup(o){const c=o,a=R(),i=J(),k=N(),_=Y(),h=p(()=>{const r=c.book.authorIds.map(i.getAuthor);if(r.length===0)return{[""]:"-"};if(r.length<3)return Object.fromEntries(r.map(l=>[l==null?void 0:l.id,l==null?void 0:l.name]));const[s]=r;return{[String(s==null?void 0:s.id)]:s==null?void 0:s.name,[""]:`and ${r.length-1} more`}});return(r,s)=>{var l;return u(),m("tr",{"data-testid":`book-item-${o.book.id}`},[t("td",null,[t("ul",Z,[(u(!0),m(C,null,E(e(h),(b,n)=>(u(),m("li",{key:n,textContent:B(b)},null,8,tt))),128))])]),t("td",null,[o.book.posterUrl?(u(),m("img",{key:0,src:o.book.posterUrl,alt:o.book.title,title:o.book.title,height:"60",width:"40",class:"poster"},null,8,et)):I("",!0)]),t("td",ot,B(o.book.title),1),t("td",null,B(o.book.year??"-"),1),t("td",null,B(o.book.category??"-"),1),t("td",st,B(o.book.price?`${(l=o.book.price)==null?void 0:l.toFixed(2)} ₽`:"-"),1),t("td",null,[t("div",lt,[t("button",{"data-testid":`book-edit-${o.book.id}`,type:"button",class:"btn btn-outline-secondary action",onClick:s[0]||(s[0]=b=>e(k).push({name:"books-edit",params:{bookId:o.book.id},query:{redirect:e(_).fullPath}}))},[(u(),x(P(e(H))))],8,nt),t("button",{"data-testid":`book-remove-${o.book.id}`,type:"button",class:"btn btn-outline-danger action",onClick:s[1]||(s[1]=b=>e(a).removeBook(o.book))}," × ",8,at)])])],8,X)}}});const it=F(dt,[["__scopeId","data-v-6562f9d0"]]),ut={},rt=t("th",{style:{width:"20%"}},"Authors",-1),ct=t("th",{style:{width:"5%"}},null,-1),_t=t("th",null,"Title",-1),mt=t("th",{style:{width:"15%"}},"Year",-1),bt=t("th",{style:{width:"15%"}},"Category",-1),pt=t("th",{style:{width:"15%"}},"Price",-1),kt=t("th",null,null,-1),ht=[rt,ct,_t,mt,bt,pt,kt];function ft(o,c){return u(),m("tr",null,ht)}const gt=F(ut,[["render",ft]]),V=o=>(L("data-v-743b7b94"),o=o(),j(),o),vt=V(()=>t("th",null,null,-1)),yt=V(()=>t("th",null,null,-1)),$t=["disabled"],Bt={class:"input-group"},xt=["disabled"],Vt=V(()=>t("span",{class:"input-group-text"},"-",-1)),wt=["disabled"],Ft=["disabled"],It={class:"input-group"},Pt=["disabled"],Tt=V(()=>t("span",{class:"input-group-text"},"-",-1)),St=["disabled"],Ct=V(()=>t("th",null,null,-1)),Et=w({__name:"BookFilter",props:{disabled:{type:Boolean},modelValue:null},emits:["undefined"],setup(o,{emit:c}){const a=o,i=b=>p({get:()=>a.modelValue[b],set(n){c("update:modelValue",{...a.modelValue,[b]:n})}}),k=i("title"),_=i("minYear"),h=i("maxYear"),r=i("category"),s=i("minPrice"),l=i("maxPrice");return(b,n)=>(u(),m("tr",null,[vt,yt,t("th",null,[v(t("input",{class:"form-control","onUpdate:modelValue":n[0]||(n[0]=d=>f(k)?k.value=d:null),disabled:a.disabled},null,8,$t),[[y,e(k)]])]),t("th",null,[t("div",Bt,[v(t("input",{type:"number",class:"form-control","onUpdate:modelValue":n[1]||(n[1]=d=>f(_)?_.value=d:null),disabled:a.disabled},null,8,xt),[[y,e(_)]]),Vt,v(t("input",{type:"number",class:"form-control","onUpdate:modelValue":n[2]||(n[2]=d=>f(h)?h.value=d:null),disabled:a.disabled},null,8,wt),[[y,e(h)]])])]),t("th",null,[v(t("input",{class:"form-control","onUpdate:modelValue":n[3]||(n[3]=d=>f(r)?r.value=d:null),disabled:a.disabled},null,8,Ft),[[y,e(r)]])]),t("th",null,[t("div",It,[v(t("input",{type:"number",class:"form-control","onUpdate:modelValue":n[4]||(n[4]=d=>f(s)?s.value=d:null),disabled:a.disabled},null,8,Pt),[[y,e(s)]]),Tt,v(t("input",{type:"number",class:"form-control","onUpdate:modelValue":n[5]||(n[5]=d=>f(l)?l.value=d:null),disabled:a.disabled},null,8,St),[[y,e(l)]])])]),Ct]))}});const Ut=F(Et,[["__scopeId","data-v-743b7b94"]]),Rt={class:"table table-striped align-middle text-center"},At=w({__name:"BookTable",setup(o){const c=R(),a=p(()=>c.fetchStatuses),i=T({}),k=p(()=>Object.values(i.value).some(Boolean)),_=p(()=>c.getBooks(i.value)),h=p(()=>c.books.length===0),r=p(()=>_.value.length===0),s=T(5),l=K("books",()=>z(_.value.length,s.value)),b=p(()=>G(_.value,l.value,s.value));return D(c.fetchBooks),(n,d)=>(u(),m("table",Rt,[t("thead",null,[$(gt),$(Ut,{disabled:e(a).disabled,modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=g=>i.value=g)},null,8,["disabled","modelValue"])]),$(Q,{title:"books",statuses:e(a),isEmpty:e(h),isEmptyByFilter:e(r)},null,8,["statuses","isEmpty","isEmptyByFilter"]),$(q,{name:"fade",mode:"out-in"},{default:U(()=>[e(a).active?(u(),m("tbody",{key:e(l)},[(u(!0),m(C,null,E(e(b),g=>(u(),x(it,{key:g.id,book:g},null,8,["book"]))),128))])):I("",!0)]),_:1}),e(a).active?(u(),x(W,{key:0,isFiltered:e(k),total:e(c).books.length,filtered:e(_).length,perPage:s.value,page:e(l),"onUpdate:page":d[1]||(d[1]=g=>f(l)?l.value=g:null)},null,8,["isFiltered","total","filtered","perPage","page"])):I("",!0)]))}}),Nt={class:"mb-3"},Yt={class:"mb-3 d-flex flex-wrap"},Lt=w({__name:"BooksView",setup(o){return(c,a)=>{const i=M("RouterLink");return u(),m("div",null,[t("h1",Nt,[(u(),x(P(e(O)))),S(" Books ")]),t("div",Yt,[$(i,{"data-testid":"book-add",to:{name:"books-add"},class:"btn btn-primary d-flex align-items-center gap-1"},{default:U(()=>[(u(),x(P(e(A)))),S(" New Book ")]),_:1})]),$(At)])}}});const zt=F(Lt,[["__scopeId","data-v-b0d48ea2"]]);export{zt as default};

import{C as A,l as k,c as N}from"./index-6733d467.js";const w={GET_BOOKS:"https://www.googleapis.com/books/v1/volumes"},y=o=>{var C,S;const{id:n,volumeInfo:c,saleInfo:u}=o,{title:i,authors:s,publishedDate:a,description:d,industryIdentifiers:l,imageLinks:e,categories:t}=c,r=(s==null?void 0:s.map(R))??[],[p]=t??[];return{book:{id:n,isbn:(C=l==null?void 0:l.find(({type:v})=>v==="ISBN_13"))==null?void 0:C.identifier,year:Number.parseInt(a)||void 0,title:i,authorIds:r.map(({id:v})=>v),posterUrl:e.thumbnail,description:d,price:(S=u.retailPrice)==null?void 0:S.amount,category:p},authors:r}},R=o=>({id:o,name:o}),I=o=>{const n=new Map;for(const{authors:c}of o)for(const u of c)n.set(u.id,u);return n},b={async getBooks(o){const c=(await fetch(`${w.GET_BOOKS}?q=${encodeURIComponent(o)}`).then(i=>i.json())).items.map(y),u=I(c);return{books:c.map(({book:i})=>i).filter(Boolean),authors:Array.from(u.values())}}},L=A("author",()=>{const o=k([]);return{authors:o,getAuthors:s=>{if(!s)return o.value;const{name:a,country:d}=s,l=a==null?void 0:a.toLowerCase(),e=d==null?void 0:d.toLowerCase();return o.value.filter(t=>{var r;return(!l||t.name.toLowerCase().includes(l))&&(!e||((r=t.country)==null?void 0:r.toLowerCase().includes(e)))})},getAuthor:s=>o.value.find(a=>a.id===s),addAuthor:async s=>{o.value.push(s)},updateAuthor:async s=>{const a=o.value.findIndex(({id:d})=>d===s.id);a!==-1&&(o.value[a]=s)}}});var h=(o=>(o.NONE="NONE",o.SUCCESS="SUCCESS",o.ERROR="ERROR",o.PENDING="PENDING",o))(h||{});const x=o=>({disabled:o!=="SUCCESS",active:o==="SUCCESS",pending:o==="PENDING",error:o==="ERROR"}),P=A("book",()=>{const o=k(h.NONE),n=k([]),c=N(()=>x(o.value)),u=e=>n.value.find(t=>t.id===e),i=async e=>{n.value.push(e)};return{fetchStatus:o,fetchStatuses:c,books:n,getBook:u,addBook:i,updateBook:async e=>{const t=n.value.findIndex(({id:r})=>r===e.id);t!==-1&&(n.value[t]=e)},removeBook:async({id:e})=>{n.value=n.value.filter(t=>t.id!==e)},getBooks:e=>{if(!e)return n.value;const{title:t,minYear:r,maxYear:p,category:E,minPrice:C,maxPrice:S}=e,v=t==null?void 0:t.toLowerCase(),m=E==null?void 0:E.toLowerCase();return n.value.filter(f=>{var B,g;return(!v||((B=f.title)==null?void 0:B.toLowerCase().includes(v)))&&(!r||r<=f.year)&&(!p||f.year<=p)&&(!m||((g=f.category)==null?void 0:g.toLowerCase().includes(m)))&&(!C||C<=f.price)&&(!S||f.price<=S)})},fetchBooks:async()=>{if(![h.PENDING,h.SUCCESS].includes(o.value))try{o.value=h.PENDING;const{books:e,authors:t}=await b.getBooks("vue.js");e.forEach(i);const r=L();t.forEach(r.addAuthor),o.value=h.SUCCESS}catch(e){o.value=h.ERROR,console.error(e.stack)}}}});export{L as a,P as u};
